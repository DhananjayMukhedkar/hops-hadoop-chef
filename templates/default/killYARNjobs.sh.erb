#!/bin/bash

state="ACCEPTED"
states="ACCEPTED RUNNING NEW SUBMITTED NEW_SAVING GENERATING_CERTS"

help() {
    echo ""
    echo "This command kills all YARN applications in the supplied state"
    echo ""
    echo "usage: $0 [yarn_application_state]"
    echo "Default state is 'ACCEPTED'. Other valid states are: $states"
    echo ""
    exit 1
}

if [ $# -gt 1 ] ; then
  help
elif [ $# -lt 0 ] ; then
  help
elif [ $# -eq 1 ] ; then
    [[ "$states" =~ (^|[[:space:]])"$1"($|[[:space:]]) ]] && echo 'valid state' || echo 'invalid state: $1'; exit 2
    state="$1"
fi    


for app in $(<%= node['hops']['bin_dir'] %>/yarn application -list | awk '$6 == "$state" { print $1 }'); do 

  <%= node['hops']['bin_dir'] %>/yarn application -kill "$app"

done
